{% extends 'base.html.j2' %}

{% block app_content %}

<!-- Transactions sorting -->
<div class="container my-1">
  <div class="btn-toolbar justify-content-between" role="toolbar" aria-label="Item sorting">
    <div class="btn-group" role="group" aria-label="Alphabet sorting">
      <a class="btn btn-outline-primary{% if sort == 'asc' %} active{% endif %}" href="{{ url_for('main.transactions', sort='asc') }}" data-original-title="Sort By Alphabet" role="button"><i class="material-icons align-middle">arrow_downward</i></a>
      <a class="btn btn-outline-primary{% if sort == 'desc' %} active{% endif %}" href="{{ url_for('main.transactions', sort='desc') }}" data-original-title="Sort By Alphabet" role="button"><i class="material-icons align-middle">arrow_upward</i></a>
    </div>
  </div>
</div>

<div style="margin-top:10px"></div>

<div class="table-responsive">
  <table class="table table-striped table-bordered">
    <thead>
      <tr>
        <th>#</th>
        <th>Date</th>
        <th>Bartender</th>
        <th>Client</th>
        <th>Type</th>
        <th>Balance</th>
        <th>Revert</th>
      </tr>
    </thead>

    <tbody>
      {% for transaction in transactions.items %}
      <tr {% if transaction.is_reverted or 'Revert' in transaction.type %}class="table-danger"{% endif %}>
        <th class="align-middle" {% if transaction.is_reverted %}style="text-decoration: line-through;"{% endif %}>{{ transaction.id }}</th>
        <td class="align-middle text-nowrap" {% if transaction.is_reverted %}style="text-decoration: line-through;"{% endif %}>{{ moment(transaction.date).format('lll') }}</td>
        <td class="align-middle" {% if transaction.is_reverted %}style="text-decoration: line-through;"{% endif %}>{{ transaction.barman }}</td>
        <td class="align-middle" {% if transaction.is_reverted %}style="text-decoration: line-through;"{% endif %}>{{ transaction.client.username }}</td>
        <td class="align-middle text-nowrap" {% if transaction.is_reverted %}style="text-decoration: line-through;"{% endif %}>{{ transaction.type }}</td>
        <td class="align-middle" {% if transaction.is_reverted %}style="text-decoration: line-through;"{% endif %}>{% if transaction.balance_change %}{{ '%0.2f' | format(transaction.balance_change) }}€{% endif %}</td>
        <td class="align-middle">
          <div class="btn-group" role="group" aria-label="Revert transaction">
            <button class="btn btn-danger dropdown-toggle{% if transaction.is_reverted or 'Revert' in transaction.type %} disabled{% endif %}" type="button" id="dropdown-revert-transaction" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <i class="material-icons align-middle">fast_rewind</i>
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdown-revert-transaction">
              <h6 class="dropdown-header">Revert this transaction?</h6>
              <a class="dropdown-item" href="{{ url_for('main.revert_transaction', transaction_id=transaction.id) }}">Yes</a>
              <a class="dropdown-item" href="#">No</a>
            </div>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    {%- for page in transactions.iter_pages() %}
    <li class="page-item{% if page == transactions.page %} active{% endif %}{%if not page %} disabled{% endif %}">
      <a class="page-link" href="{{ url_for('main.transactions', page=page) }}">
        {% if page %}
        {{ page }}
        {% else %}
        <span class=ellipsis>…</span>
        {% endif %}
      </a>
      {%- endfor %}
    </li>
  </ul>
</nav>
{% endblock %}
