{% extends 'base.html.j2' %}
{% import 'bootstrap/wtf.html' as wtf %}

{% block app_content %}

<!-- Transactions sorting -->
<div class="well">
  <div class="container-fluid">
    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="btn-group">
          <a href="{{ url_for('main.transactions', sort='asc') }}" data-original-title="Sort by order" type="button" class="btn btn-info {% if sort == 'asc' %}active{% endif %}"><span class="glyphicon glyphicon-sort-by-order"></span></a>
          <a href="{{ url_for('main.transactions', sort='desc') }}" data-original-title="Sort by order" type="button" class="btn btn-info {% if sort == 'desc' %}active{% endif %}"><span class="glyphicon glyphicon-sort-by-order-alt"></span></a>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid">
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xs-offset-0 col-sm-offset-0 col-md-offset-0 col-lg-offset-0" >
      <div class="panel panel-default table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>#</th>
              <th>Date</th>
              <th>Bartender</th>
              <th>Client</th>
              <th>Type</th>
              <th>Balance</th>
              <th>Revert</th>
            </tr>
          </thead>

          <tbody>
            {% for transaction in transactions.items %}
            <tr {% if transaction.is_reverted or 'Revert' in transaction.type %}class="danger"{% endif %}>
              <th {% if transaction.is_reverted %}style="text-decoration: line-through;"{% endif %}>{{ transaction.id }}</th>
              <td {% if transaction.is_reverted %}style="text-decoration: line-through;"{% endif %}>{{ moment(transaction.date).format('lll') }}</td>
              <td {% if transaction.is_reverted %}style="text-decoration: line-through;"{% endif %}>{{ transaction.barman }}</td>
              <td {% if transaction.is_reverted %}style="text-decoration: line-through;"{% endif %}>{{ transaction.client.username }}</td>
              <td {% if transaction.is_reverted %}style="text-decoration: line-through;"{% endif %}>{{ transaction.type }}</td>
              <td {% if transaction.is_reverted %}style="text-decoration: line-through;"{% endif %}>{% if transaction.balance_change %}{{ '%0.2f' | format(transaction.balance_change) }}€{% endif %}</td>
              <td>
                <div class="btn-group">
                  <button type="button" class="btn btn-sm btn-danger dropdown-toggle {% if transaction.is_reverted or 'Revert' in transaction.type %}disabled{% endif %}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span class="glyphicon glyphicon-remove"></span>
                  </button>
                  <ul class="dropdown-menu dropdown-menu-right">
                    <li class="dropdown-header">Revert this transaction?</li>
                    <li><a href="{{ url_for('main.revert_transaction', transaction_id=transaction.id) }}">Yes</a></li>
                    <li><a href="#">No</a></li>
                  </ul>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="pager">
  <div class="btn-group" role="group">
    {% for page in transactions.iter_pages() %}
    <a href="{{ url_for('main.transactions', page=page) }}" type="button" class="btn {% if page == transactions.page %}btn-primary{% else %}btn-default{% endif %} {% if not page %}disabled{% endif %}">
      {% if page %}
      {% if page != transactions.page %}
      {{ page }}
      {% else %}
      <strong>{{ page }}</strong>
      {% endif %}
      {% else %}
      <span class=ellipsis>…</span>
      {% endif %}
    </a>
    {% endfor %}
  </div>
</div>
</div>
{% endblock %}
